!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@angular/forms"),require("angular5-social-login"),require("ionic-angular"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","@angular/forms","angular5-social-login","ionic-angular","@angular/common"],o):o((t.ng=t.ng||{},t.ng.capauthentication={}),t.ng.core,null,null,null,null,null,null,null)}(this,function(t,n,e,o,i,r,a,s,l){"use strict";var u=function(){function t(t){t&&(this.apiUrl=t.apiUrl,this.loginEndpoint=t.loginEndpoint,this.facebookId=t.facebookId,this.googleId=t.googleId)}return t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:t,decorators:[{type:n.Optional}]}]},t}(),c=function(){function t(t,o){this._http=t,this._config=o,this.userId="",this.isLoggedIn=!1,this.userData={},this.httpOptions={headers:new e.HttpHeaders({"Content-Type":"application/json"})},this.actionUrl=""+this._config.apiUrl+this._config.loginEndpoint,this._token=localStorage.getItem("token")||""}return t.prototype.login=function(t){var o=this,e=JSON.stringify(t);return this._http.post(this.actionUrl+"/login",e,this.httpOptions).pipe(i.map(function(t){return t}),i.catchError(this.handleError),i.tap(function(t){return void 0!==t.id&&(o.isLoggedIn=!0,o._token=t.id,localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",t.userId||""),localStorage.setItem("created",t.created||""),localStorage.setItem("token",t.id),localStorage.setItem("email",t.email||"")),t}))},t.prototype.changePassword=function(t){var o={oldPassword:t.password,newPassword:t.repassword},e=JSON.stringify(o);return this._http.post(this.actionUrl+"/change-password?access_token="+this._token,e,this.httpOptions).pipe(i.map(function(t){return t}),i.catchError(this.handleError),i.tap(function(t){return t}))},t.prototype.register=function(t){var o=JSON.stringify(t);return this._http.post(this.actionUrl+"/",o,this.httpOptions).pipe(i.map(function(t){return t}),i.catchError(this.handleError),i.tap(function(t){return t}))},t.prototype.editProfile=function(t){var o={newUsername:t.username},e=JSON.stringify(o);return this._http.put(this.actionUrl+"/"+this.userId,e,this.httpOptions).pipe(i.map(function(t){return t}),i.catchError(this.handleError),i.tap(function(t){return t}))},t.prototype.logout=function(){this.isLoggedIn=!1,this._token="",localStorage.removeItem("isLoggedIn"),localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("created"),console.log("logout","Has cerrado sesi√≥n correctamente")},t.prototype.token=function(){return this._token},t.prototype.isAuthenticated=function(){return!!this.isLoggedIn},t.prototype.handleError=function(t){return console.log(t),o.Observable.throw(t||"Server error")},t.prototype.saveSocialMediaData=function(t){this.userData=t},t.prototype.getUserData=function(){if(0!==this.userData.length)return this.userData},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:e.HttpClient},{type:u}]},t}(),p=function(){function t(t,o){this.authenticationService=t,this.formBuilder=o,this.submit=new n.EventEmitter,this.changePage=new n.EventEmitter,this.credentials={username:"",email:"",password:"",repassword:""}}return t.prototype.ngOnInit=function(){this.registerform=this.formBuilder.group({username:["",[r.Validators.required,r.Validators.minLength(3)]],password:["",[r.Validators.required,r.Validators.minLength(3)]],repassword:["",[r.Validators.required,r.Validators.minLength(3)]],email:["",[r.Validators.required,r.Validators.minLength(3)]]})},t.prototype.onSubmit=function(){var o=this;if(this.credentials.password!==this.credentials.repassword)return console.log("passwords must be equal"),!1;this.authenticationService.register(this.credentials).subscribe(function(t){o.submit.emit(t)})},t.prototype.loginAccount=function(){this.changePage.emit(!0)},t.decorators=[{type:n.Component,args:[{selector:"auth-app-register",template:'\n<ion-grid>\n   <ion-row>\n     <ion-col  col-12 col-xl-8 offset-xl-2 col-lg-10 offset-lg-1>\n        <ion-list>\n            <form [formGroup]="registerform" (ngSubmit)="onSubmit()">\n                <ion-item>\n                    <ion-label stacked primary>Username</ion-label>\n                    <ion-input [(ngModel)]="credentials.username" formControlName="username"\n                            type="text" id="username" spellcheck="false" autocapitalize="off" ngDefaultControl>\n                    </ion-input>\n                </ion-item>\n                <ion-item>\n                    <ion-label stacked primary>Email</ion-label>\n                    <ion-input [(ngModel)]="credentials.email" formControlName="email"\n                            type="text" id="email" spellcheck="false" autocapitalize="off" ngDefaultControl>\n                    </ion-input>\n                </ion-item>\n                <ion-item>\n                    <ion-label stacked primary>Password</ion-label>\n                    <ion-input [(ngModel)]="credentials.password" formControlName="password" type="text" id="password">\n                    </ion-input>\n                </ion-item>\n                <ion-item>\n                    <ion-label stacked primary>Repeat Password</ion-label>\n                    <ion-input [(ngModel)]="credentials.repassword" formControlName="repassword" type="text" id="repassword">\n                    </ion-input>\n                </ion-item>\n                <button ion-button type="submit" block full primary [disabled]="!registerform.valid">Register</button>\n                <button ion-button type="submit" block secondary (click)="loginAccount()">Login to account</button>\n                <social-login></social-login>\n            </form>\n        </ion-list>\n     </ion-col>\n   </ion-row>\n </ion-grid>\n    ',styles:[""],encapsulation:n.ViewEncapsulation.Emulated}]}],t.ctorParameters=function(){return[{type:c},{type:r.FormBuilder}]},t.propDecorators={submit:[{type:n.Output}],changePage:[{type:n.Output}]},t}(),d=function(){function t(t,o,e){this.authenticationService=t,this.formBuilder=o,this.authServiceConfig=e,this.submit=new n.EventEmitter,this.changePage=new n.EventEmitter,this.credentials={email:"",password:""}}return t.prototype.ngOnInit=function(){this.loginform=this.formBuilder.group({password:["",[r.Validators.required,r.Validators.minLength(3)]],email:["",r.Validators.required]})},t.prototype.onSubmit=function(){var o=this;this.authenticationService.login(this.credentials).subscribe(function(t){o.submit.emit(t)})},t.prototype.createAccount=function(){this.changePage.emit(!0)},t.decorators=[{type:n.Component,args:[{selector:"auth-app-login",template:' \n<ion-grid>\n   <ion-row>\n     <ion-col col-12 col-xl-8 offset-xl-2 col-lg-10 offset-lg-1>\n        <ion-list>\n            <form [formGroup]="loginform" (ngSubmit)="onSubmit()">\n            <ion-item>\n                <ion-label stacked primary>Email</ion-label>\n                <ion-input [(ngModel)]="credentials.email" formControlName="email"\n                        type="text" id="email" spellcheck="false" autocapitalize="off" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n            <ion-item>\n                <ion-label stacked primary>Password</ion-label>\n                <ion-input [(ngModel)]="credentials.password" formControlName="password" type="text" id="password" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n            <button ion-button type="submit" block primary [disabled]="!loginform.valid">Login</button>\n            <button ion-button type="submit" block secondary (click)="createAccount()">Create an account</button>\n            <social-login></social-login>\n            </form>\n        </ion-list>\n     </ion-col>\n   </ion-row>\n </ion-grid>\n        ',styles:[""],encapsulation:n.ViewEncapsulation.Emulated}]}],t.ctorParameters=function(){return[{type:c},{type:r.FormBuilder},{type:a.AuthServiceConfig}]},t.propDecorators={submit:[{type:n.Output}],changePage:[{type:n.Output}]},t}(),m=function(){function t(t,o){this.authenticationService=t,this.formBuilder=o,this.submit=new n.EventEmitter,this.changePage=new n.EventEmitter,this.credentials={username:"",password:""},this.credentials={username:"",password:""}}return t.prototype.ngOnInit=function(){this.editForm=this.formBuilder.group({username:["",[r.Validators.required,r.Validators.minLength(3)]]})},t.prototype.onSubmit=function(){var o=this;this.authenticationService.editProfile(this.credentials).subscribe(function(t){o.submit.emit(t)})},t.decorators=[{type:n.Component,args:[{selector:"auth-app-edit-profile",template:'\n    <ion-grid>\n        <ion-row>\n        <ion-col  col-12 col-xl-8 offset-xl-2 col-lg-10 offset-lg-1>\n            <ion-list>\n                <form [formGroup]="editForm" (ngSubmit)="onSubmit()">\n                    <ion-item>\n                        <ion-label stacked primary>Username</ion-label>\n                        <ion-input [(ngModel)]="credentials.username" formControlName="username"\n                                type="text" id="username" spellcheck="false" autocapitalize="off" ngDefaultControl>\n                        </ion-input>\n                    </ion-item>\n                    \n                    <button ion-button type="submit" block full primary [disabled]="!editForm.valid">Edit</button>\n                </form>\n            </ion-list>\n        </ion-col>\n        </ion-row>\n    </ion-grid> ',styles:[""],encapsulation:n.ViewEncapsulation.Emulated}]}],t.ctorParameters=function(){return[{type:c},{type:r.FormBuilder}]},t.propDecorators={submit:[{type:n.Output}],changePage:[{type:n.Output}]},t}(),g=function(){function t(t,o){this.authenticationService=t,this.formBuilder=o,this.submit=new n.EventEmitter,this.changePage=new n.EventEmitter,this.credentials={password:"",repassword:""},this.credentials={password:"",repassword:""}}return t.prototype.ngOnInit=function(){this.changeform=this.formBuilder.group({password:["",[r.Validators.required,r.Validators.minLength(3)]],repassword:["",[r.Validators.required,r.Validators.minLength(3)]]})},t.prototype.onSubmit=function(){var o=this;this.authenticationService.changePassword(this.changeform.value).subscribe(function(t){o.submit.emit(t)})},t.prototype.loginAccount=function(){this.changePage.emit(!0)},t.decorators=[{type:n.Component,args:[{selector:"auth-app-change-password",template:'\n<ion-grid>\n   <ion-row>\n     <ion-col  col-12 col-xl-8 offset-xl-2 col-lg-10 offset-lg-1>\n        <ion-list>\n            <form [formGroup]="changeform" (ngSubmit)="onSubmit()">\n            <ion-item>\n                <ion-label stacked primary>Password</ion-label>\n                <ion-input [(ngModel)]="credentials.password" formControlName="password" type="text" id="password" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n            <ion-item>\n                <ion-label stacked primary>Repeat Password</ion-label>\n                <ion-input [(ngModel)]="credentials.repassword" formControlName="repassword" type="text" id="repassword" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n            <button ion-button type="submit" block full primary [disabled]="!changeform.valid">Change Password</button>\n            <button ion-button type="submit" block secondary (click)="loginAccount()">Login to account</button>\n            </form>\n        </ion-list>\n     </ion-col>\n   </ion-row>\n </ion-grid>\n  ',styles:[""],encapsulation:n.ViewEncapsulation.Emulated}]}],t.ctorParameters=function(){return[{type:c},{type:r.FormBuilder}]},t.propDecorators={submit:[{type:n.Output}],changePage:[{type:n.Output}]},t}(),h=function(){function t(t,o){this.socialAuthService=t,this.authenticationService=o,this.socialMedia=[{name:"Facebook",color:"blue",icon:"facebook"},{name:"Google",color:"danger",icon:"googleplus"}]}return t.prototype.ngOnInit=function(){},t.prototype.socialSignIn=function(t){var o,e=this;"Facebook"==t?o=a.FacebookLoginProvider.PROVIDER_ID:"Google"==t&&(o=a.GoogleLoginProvider.PROVIDER_ID),this.socialAuthService.signIn(o).then(function(t){e.authenticationService.isLoggedIn=!0,e.authenticationService.saveSocialMediaData(t)})},t.decorators=[{type:n.Component,args:[{selector:"social-login",template:'\n    <div *ngIf="socialMedia">\n      <div *ngFor="let social of socialMedia">\n        <button ion-button color="{{social.color}}" type="submit" block secondary (click)="socialSignIn(social.name)" icon-end>\n          {{ social.name }}    \n          <ion-icon md="logo-{{ social.icon }}" name="logo-{{ social.icon }}" item-right></ion-icon> \n        </button>\n      </div>\n    </div>\n    '}]}],t.ctorParameters=function(){return[{type:a.AuthService},{type:c}]},t}(),f=function(){function o(){}return o.forRoot=function(t){return{ngModule:o,providers:[{provide:u,useValue:t},{provide:a.AuthServiceConfig,useFactory:function(){return new a.AuthServiceConfig([{id:a.FacebookLoginProvider.PROVIDER_ID,provider:new a.FacebookLoginProvider(t.facebookId)},{id:a.GoogleLoginProvider.PROVIDER_ID,provider:new a.GoogleLoginProvider(t.googleId)}])}}]}},o.decorators=[{type:n.NgModule,args:[{declarations:[d,p,g,m,h],imports:[s.IonicModule,e.HttpClientModule,r.ReactiveFormsModule,l.CommonModule,a.SocialLoginModule],exports:[e.HttpClientModule,r.ReactiveFormsModule,l.CommonModule,d,p,g,m],providers:[c],schemas:[n.CUSTOM_ELEMENTS_SCHEMA]}]}],o}();t.AuthenticationModule=f,t.AuthenticationService=c,t.AuthLoginComponent=d,t.AuthRegisterComponent=p,t.AuthChangePasswordComponent=g,Object.defineProperty(t,"__esModule",{value:!0})});