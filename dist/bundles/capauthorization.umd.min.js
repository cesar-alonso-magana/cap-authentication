!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators"),require("@angular/forms"),require("ionic-angular"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common/http","rxjs","rxjs/operators","@angular/forms","ionic-angular","@angular/common"],e):e((t.ng=t.ng||{},t.ng.capauthorization={}),t.ng.core,null,null,null,null,null,null)}(this,function(t,n,o,e,i,r,a,s){"use strict";var u=function(){function t(t){t&&(this.apiUrl=t.apiUrl,this.loginEndpoint=t.loginEndpoint)}return t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:t,decorators:[{type:n.Optional}]}]},t}(),l=function(){function t(t,e){this._http=t,this._config=e,this.isLoggedIn=!1,this.httpOptions={headers:new o.HttpHeaders({"Content-Type":"application/json"})},this.actionUrl=""+this._config.apiUrl+this._config.loginEndpoint,this._token=localStorage.getItem("token")||""}return t.prototype.login=function(t){var e=this,n=JSON.stringify(t);return this._http.post(this.actionUrl+"/login",n,this.httpOptions).pipe(i.map(function(t){return t}),i.catchError(this.handleError),i.tap(function(t){return void 0!==t.id&&(e.isLoggedIn=!0,e._token=t.id,localStorage.setItem("isLoggedIn","true"),localStorage.setItem("userId",t.userId||""),localStorage.setItem("created",t.created||""),localStorage.setItem("token",t.id)),t}))},t.prototype.changePassword=function(t){var e={oldPassword:t.password,newPassword:t.repassword},n=JSON.stringify(e);return this._http.post(this.actionUrl+"/change-password?access_token="+this._token,n,this.httpOptions).pipe(i.map(function(t){return t}),i.catchError(this.handleError),i.tap(function(t){return t}))},t.prototype.register=function(t){var e=JSON.stringify(t);return this._http.post(this.actionUrl+"/",e,this.httpOptions).pipe(i.map(function(t){return t}),i.catchError(this.handleError),i.tap(function(t){return t}))},t.prototype.logout=function(){this.isLoggedIn=!1,this._token="",localStorage.removeItem("isLoggedIn"),localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("created"),console.log("logout","Has cerrado sesi√≥n correctamente")},t.prototype.token=function(){return this._token},t.prototype.isAuthenticated=function(){return!!this.isLoggedIn},t.prototype.handleError=function(t){return console.log(t),e.Observable.throw(t||"Server error")},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:o.HttpClient},{type:u}]},t}(),p=function(){function t(t,e){this.authenticationService=t,this.formBuilder=e,this.submit=new n.EventEmitter,this.changePage=new n.EventEmitter,this.credentials={email:"",password:"",repassword:""}}return t.prototype.ngOnInit=function(){this.registerform=this.formBuilder.group({password:["",[r.Validators.required,r.Validators.minLength(3)]],repassword:["",[r.Validators.required,r.Validators.minLength(3)]],email:["",[r.Validators.required,r.Validators.minLength(3)]]})},t.prototype.onSubmit=function(){var e=this;if(this.credentials.password!==this.credentials.repassword)return console.log("passwords must be equal"),!1;this.authenticationService.register(this.credentials).subscribe(function(t){e.submit.emit(t)})},t.prototype.loginAccount=function(){this.changePage.emit(!0)},t.decorators=[{type:n.Component,args:[{selector:"auth-app-register",template:'\n    <ion-list>\n        <form [formGroup]="registerform" (ngSubmit)="onSubmit()">\n\n            <ion-item>\n                <ion-label stacked primary>Email</ion-label>\n                <ion-input [(ngModel)]="credentials.email" formControlName="email"\n                        type="text" id="email" spellcheck="false" autocapitalize="off" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n            \n            <ion-item>\n                <ion-label stacked primary>Password</ion-label>\n                <ion-input [(ngModel)]="credentials.password" formControlName="password" type="text" id="password">\n                </ion-input>\n            </ion-item>\n\n            <ion-item>\n                <ion-label stacked primary>Repeat Password</ion-label>\n                <ion-input [(ngModel)]="credentials.repassword" formControlName="repassword" type="text" id="repassword">\n                </ion-input>\n            </ion-item>\n\n            <button ion-button type="submit" block full primary [disabled]="!registerform.valid">Register</button>\n            <button ion-button type="submit" block secondary (click)="loginAccount()">Login to account</button>\n\n        </form>\n    </ion-list>\n    ',styles:[""],encapsulation:n.ViewEncapsulation.Emulated}]}],t.ctorParameters=function(){return[{type:l},{type:r.FormBuilder}]},t.propDecorators={submit:[{type:n.Output}],changePage:[{type:n.Output}]},t}(),c=function(){function t(t,e){this.authenticationService=t,this.formBuilder=e,this.submit=new n.EventEmitter,this.changePage=new n.EventEmitter,this.credentials={email:"",password:""}}return t.prototype.ngOnInit=function(){this.loginform=this.formBuilder.group({password:["",[r.Validators.required,r.Validators.minLength(3)]],email:["",r.Validators.required]})},t.prototype.onSubmit=function(){var e=this;this.authenticationService.login(this.credentials).subscribe(function(t){e.submit.emit(t)})},t.prototype.createAccount=function(){this.changePage.emit(!0)},t.decorators=[{type:n.Component,args:[{selector:"auth-app-login",template:'\n        <ion-list>\n            <form [formGroup]="loginform" (ngSubmit)="onSubmit()">\n\n            <ion-item>\n                <ion-label stacked primary>Email</ion-label>\n                <ion-input [(ngModel)]="credentials.email" formControlName="email"\n                        type="text" id="email" spellcheck="false" autocapitalize="off" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n            <ion-item>\n                <ion-label stacked primary>Password</ion-label>\n                <ion-input [(ngModel)]="credentials.password" formControlName="password" type="text" id="password" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n\n            <button ion-button type="submit" block primary [disabled]="!loginform.valid">Login</button>\n            <button ion-button type="submit" block secondary (click)="createAccount()">Create an account</button>\n\n            </form>\n        </ion-list>\n        ',styles:[""],encapsulation:n.ViewEncapsulation.Emulated}]}],t.ctorParameters=function(){return[{type:l},{type:r.FormBuilder}]},t.propDecorators={submit:[{type:n.Output}],changePage:[{type:n.Output}]},t}(),d=function(){function t(t,e){this.authenticationService=t,this.formBuilder=e,this.submit=new n.EventEmitter,this.changePage=new n.EventEmitter,this.credentials={password:"",repassword:""},this.credentials={password:"",repassword:""}}return t.prototype.ngOnInit=function(){this.changeform=this.formBuilder.group({password:["",[r.Validators.required,r.Validators.minLength(3)]],repassword:["",[r.Validators.required,r.Validators.minLength(3)]]})},t.prototype.onSubmit=function(){var e=this;this.authenticationService.changePassword(this.changeform.value).subscribe(function(t){e.submit.emit(t)})},t.prototype.loginAccount=function(){this.changePage.emit(!0)},t.decorators=[{type:n.Component,args:[{selector:"auth-app-change-password",template:'\n        <ion-list>\n            <form [formGroup]="changeform" (ngSubmit)="onSubmit()">\n\n            <ion-item>\n                <ion-label stacked primary>Password</ion-label>\n                <ion-input [(ngModel)]="credentials.password" formControlName="password" type="text" id="password" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n\n            <ion-item>\n                <ion-label stacked primary>Repeat Password</ion-label>\n                <ion-input [(ngModel)]="credentials.repassword" formControlName="repassword" type="text" id="repassword" ngDefaultControl>\n                </ion-input>\n            </ion-item>\n\n            <button ion-button type="submit" block full primary [disabled]="!changeform.valid">Change Password</button>\n            <button ion-button type="submit" block secondary (click)="loginAccount()">Login to account</button>\n\n            </form>\n        </ion-list>\n  ',styles:[""],encapsulation:n.ViewEncapsulation.Emulated}]}],t.ctorParameters=function(){return[{type:l},{type:r.FormBuilder}]},t.propDecorators={submit:[{type:n.Output}],changePage:[{type:n.Output}]},t}(),m=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:u,useValue:t}]}},e.decorators=[{type:n.NgModule,args:[{declarations:[c,p,d],imports:[a.IonicModule,o.HttpClientModule,r.ReactiveFormsModule,s.CommonModule],exports:[o.HttpClientModule,r.ReactiveFormsModule,s.CommonModule,c,p,d],providers:[l],schemas:[n.CUSTOM_ELEMENTS_SCHEMA]}]}],e}();t.AuthenticationModule=m,t.AuthenticationService=l,t.AuthLoginComponent=c,t.AuthRegisterComponent=p,t.AuthChangePasswordComponent=d,Object.defineProperty(t,"__esModule",{value:!0})});